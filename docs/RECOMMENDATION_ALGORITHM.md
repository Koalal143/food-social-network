# ü§ñ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ "–í–∫—É—Å–≤–∞–π–ø" –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Ä–µ—Ü–µ–ø—Ç–æ–≤.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π](#-–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π)
  - [–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ —Ü–µ–ª–∏](#–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ-–∏-—Ü–µ–ª–∏)
  - [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π-–ø–æ–¥—Ö–æ–¥)
  - [–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- [–ê–ª–≥–æ—Ä–∏—Ç–º MMR (Maximal Marginal Relevance)](#-–∞–ª–≥–æ—Ä–∏—Ç–º-mmr-maximal-marginal-relevance)
  - [–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞](#–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è-—Ñ–æ—Ä–º—É–ª–∞)
  - [–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞](#–ø–∞—Ä–∞–º–µ—Ç—Ä—ã-–∞–ª–≥–æ—Ä–∏—Ç–º–∞)
  - [–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã](#–ø—Ä–∏–Ω—Ü–∏–ø-—Ä–∞–±–æ—Ç—ã)
  - [–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-–¥–µ—Ç–∞–ª–∏-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
  - [–í–µ–∫—Ç–æ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —á–µ—Ä–µ–∑ GigaChat](#–≤–µ–∫—Ç–æ—Ä–Ω—ã–µ-—ç–º–±–µ–¥–¥–∏–Ω–≥–∏-—á–µ—Ä–µ–∑-gigachat)
  - [–†–∞–±–æ—Ç–∞ —Å Qdrant –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö](#—Ä–∞–±–æ—Ç–∞-—Å-qdrant-–≤–µ–∫—Ç–æ—Ä–Ω–æ–π-–±–∞–∑–æ–π-–¥–∞–Ω–Ω—ã—Ö)
  - [–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö-–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π)
  - [–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤](#—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è-–ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö-—Ä–µ—Ü–µ–ø—Ç–æ–≤)
- [–ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π](#-–ø—Ä–æ—Ü–µ—Å—Å-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π)
  - [–ü–æ—à–∞–≥–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º](#–ø–æ—à–∞–≥–æ–≤—ã–π-–∞–ª–≥–æ—Ä–∏—Ç–º)
  - [–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã](#–≤—Ö–æ–¥–Ω—ã–µ-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
  - [–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ](#–≤—ã—Ö–æ–¥–Ω—ã–µ-–¥–∞–Ω–Ω—ã–µ)

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ —Ü–µ–ª–∏

–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π "–í–∫—É—Å–≤–∞–π–ø" –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è:

- üéØ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üîÑ **–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞** - –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è "–ø—É–∑—ã—Ä—è —Ñ–∏–ª—å—Ç—Ä–æ–≤"
- üìà **–£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞** - –ø–æ–≤—ã—à–µ–Ω–∏–µ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- üß† **–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö ML –ø–æ–¥—Ö–æ–¥–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ **–≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞**, —Å–æ—á–µ—Ç–∞—é—â–µ–≥–æ:

1. **Content-Based Filtering** - –∞–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–æ–≤ —á–µ—Ä–µ–∑ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
2. **MMR –∞–ª–≥–æ—Ä–∏—Ç–º** - –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
3. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫** - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ –≤ –≤—ã—Å–æ–∫–æ—Ä–∞–∑–º–µ—Ä–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```mermaid
graph TB
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] --> B[RecommendationAlgorithm]
    B --> C[UserPreferences]
    B --> D[GigaChat Embeddings]
    B --> E[Qdrant Vector DB]
    B --> F[MMR Selection]

    C --> G[–õ–∞–π–∫–∏/–î–∏–∑–ª–∞–π–∫–∏]
    C --> H[–ü—Ä–æ—Å–º–æ—Ç—Ä—ã]
    C --> I[–ê–≤—Ç–æ—Ä—Å–∫–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã]

    D --> J[–í–µ–∫—Ç–æ—Ä—ã —Ä–µ—Ü–µ–ø—Ç–æ–≤]
    E --> K[–ü–æ–∏—Å–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤]
    F --> L[–§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏]
```

## üßÆ –ê–ª–≥–æ—Ä–∏—Ç–º MMR (Maximal Marginal Relevance)

### –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞

MMR –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Ñ–æ—Ä–º—É–ª—É –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:

```
MMR = Œª √ó Relevance(q, d) - (1 - Œª) √ó max[Similarity(d, di)]
```

–ì–¥–µ:
- **Œª (lambda_mult)** - –ø–∞—Ä–∞–º–µ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å—é –∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ–º [0, 1]
- **Relevance(q, d)** - —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞ d –∫ –∑–∞–ø—Ä–æ—Å—É q
- **Similarity(d, di)** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–æ–∂–µ—Å—Ç—å —Å —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
- **q** - –≤–µ–∫—Ç–æ—Ä –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **d** - –∫–∞–Ω–¥–∏–¥–∞—Ç –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- **di** - —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞

#### `lambda_mult` (Œª) - –ë–∞–ª–∞–Ω—Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è

- **–î–∏–∞–ø–∞–∑–æ–Ω**: [0.0, 1.0]
- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é**: 0.5
- **–í–ª–∏—è–Ω–∏–µ**:
  - `Œª = 1.0` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
  - `Œª = 0.0` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å
  - `Œª = 0.5` - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥

#### `fetch_k` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

- **–î–∏–∞–ø–∞–∑–æ–Ω**: [limit, 200]
- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é**: 20
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–ª—è MMR —Å–µ–ª–µ–∫—Ü–∏–∏

#### `limit` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

- **–î–∏–∞–ø–∞–∑–æ–Ω**: [1, 100]
- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é**: 10
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤** - –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–∞—Ö–æ–¥–∏—Ç `fetch_k` –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤
2. **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è —Å–µ–ª–µ–∫—Ü–∏—è** - MMR –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ—Ü–µ–ø—Ç—ã, –º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É—è —Ñ–æ—Ä–º—É–ª—É
3. **–ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è** - –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –≤—ã–±–æ—Ä —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ö–æ–∂–µ—Å—Ç—å —Å —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏
4. **–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç** - `limit` —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- ‚úÖ **–ò–∑–±–µ–∂–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤
- ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä Œª
- ‚úÖ **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ** - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –í–µ–∫—Ç–æ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —á–µ—Ä–µ–∑ GigaChat

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **GigaChat API** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤:

```python
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –¥–ª—è —Ä–µ—Ü–µ–ø—Ç–∞
embedding = await embeddings_repo.get_embedding(f"{title}, {tags}")
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**:
- **–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å**: 1024 –∏–∑–º–µ—Ä–µ–Ω–∏—è
- **–¢–∏–ø**: Dense –≤–µ–∫—Ç–æ—Ä—ã —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**: L2 –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞ + —Ç–µ–≥–∏

### –†–∞–±–æ—Ç–∞ —Å Qdrant –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

**Qdrant** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤–µ–∫—Ç–æ—Ä–æ–≤:

```python
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏
vectors_config = VectorParams(size=1024, distance=Distance.COSINE)

# –ü–æ–∏—Å–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
candidates = await qdrant_repo.get_recommendations(
    query_vector=user_vector,
    limit=fetch_k,
    exclude_ids=exclude_ids
)
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- **–ú–µ—Ç—Ä–∏–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è**: –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: HNSW –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∏–ª–ª–∏–æ–Ω–æ–≤ –≤–µ–∫—Ç–æ—Ä–æ–≤

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π

–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç **5 —Ç–∏–ø–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π**:

```python
class UserPreferences:
    favorite_recipes_ids: list[int]      # –õ–∞–π–∫–Ω—É—Ç—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
    disliked_recipes_ids: list[int]      # –î–∏–∑–ª–∞–π–∫–Ω—É—Ç—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
    viewed_recipes_ids: list[int]        # –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
    recs_detail_recipes_ids: list[int]   # –î–µ—Ç–∞–ª—å–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –∏–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
    author_recipes_ids: list[int]        # –ê–≤—Ç–æ—Ä—Å–∫–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π**:

1. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤** - –∫–∞–∂–¥—ã–π –≤–µ–∫—Ç–æ—Ä –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –ø–æ L2 –Ω–æ—Ä–º–µ
2. **–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º** - –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Å—Ä–µ–¥–Ω–∏–π –≤–µ–∫—Ç–æ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
3. **–í–∑–≤–µ—à–µ–Ω–Ω–æ–µ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   ```python
   user_vector = liked_emb * 2.0           # –õ–∞–π–∫–∏: –≤–µ—Å 2.0
                - disliked_emb * 1.0       # –î–∏–∑–ª–∞–π–∫–∏: –≤–µ—Å -1.0
                + viewed_emb * 0.2         # –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: –≤–µ—Å 0.2
                + recs_detail_emb * 0.2    # –î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã: –≤–µ—Å 0.2
   ```
4. **–§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è** - –∏—Ç–æ–≥–æ–≤—ã–π –≤–µ–∫—Ç–æ—Ä –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è

**–í–µ—Å–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π**:
- üî• **–õ–∞–π–∫–∏ (2.0)** - –Ω–∞–∏–±–æ–ª—å—à–∏–π –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –≤–µ—Å
- üëé **–î–∏–∑–ª–∞–π–∫–∏ (-1.0)** - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –≤–µ—Å –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- üëÄ **–ü—Ä–æ—Å–º–æ—Ç—Ä—ã (0.2)** - —Å–ª–∞–±—ã–π –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª
- üîç **–î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã (0.2)** - –∏–Ω—Ç–µ—Ä–µ—Å –∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞–µ—Ç –∏–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:

```python
exclude_ids = (
    user_preferences.favorite_recipes_ids +      # –£–∂–µ –ª–∞–π–∫–Ω—É—Ç—ã–µ
    user_preferences.disliked_recipes_ids +      # –î–∏–∑–ª–∞–π–∫–Ω—É—Ç—ã–µ
    user_preferences.author_recipes_ids          # –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
)
```

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** (–ø–∞—Ä–∞–º–µ—Ç—Ä `exclude_viewed`):
- ‚úÖ **–í–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** - –∏—Å–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
- ‚ùå **–û—Ç–∫–ª—é—á–µ–Ω–∞** - –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–Ω–µ–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### –ü–æ—à–∞–≥–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º

```mermaid
flowchart TD
    A[–ó–∞–ø—Ä–æ—Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π] --> B[–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤]
    B --> C[–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π]
    C --> D[–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π]
    D --> E[–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤]
    E --> F[–ü–æ–ª—É—á–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤]
    F --> G[MMR —Å–µ–ª–µ–∫—Ü–∏—è]
    G --> H[–í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π]

    C --> C1[–õ–∞–π–∫–∏/–î–∏–∑–ª–∞–π–∫–∏]
    C --> C2[–ü—Ä–æ—Å–º–æ—Ç—Ä—ã]
    C --> C3[–ê–≤—Ç–æ—Ä—Å–∫–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã]

    D --> D1[–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤]
    D --> D2[–í–∑–≤–µ—à–µ–Ω–Ω–æ–µ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ]
    D --> D3[–§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è]

    E --> E1[–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö]
    E --> E2[–ü–æ–∏—Å–∫ fetch_k –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤]

    G --> G1[–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è —Å–µ–ª–µ–∫—Ü–∏—è]
    G --> G2[–ë–∞–ª–∞–Ω—Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏/—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è]
    G --> G3[–í—ã–±–æ—Ä limit —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π]
```

### –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```python
async def get_recommendations(
    user_id: int,                    # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    limit: int = 10,                 # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
    fetch_k: int = 20,               # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–ª—è MMR
    lambda_mult: float = 0.5,        # –ë–∞–ª–∞–Ω—Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏/—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
    exclude_viewed: bool = True      # –ò—Å–∫–ª—é—á–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
) -> list[dict]:
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**:
- `user_id > 0` - –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `limit > 0` - –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- `fetch_k >= limit` - –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–µ –º–µ–Ω—å—à–µ —á–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- `0 <= lambda_mult <= 1` - –ø–∞—Ä–∞–º–µ—Ç—Ä Œª –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ

### –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

```python
[
    {
        "recipe_id": 123,           # ID —Ä–µ—Ü–µ–ø—Ç–∞
        "score": 0.85,              # MMR –æ—Ü–µ–Ω–∫–∞ [0, 2]
        "payload": {                # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            "title": "–ë–æ—Ä—â –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π",
            "tags": "—Å—É–ø, –æ–≤–æ—â–∏, –º—è—Å–æ"
        }
    },
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
]
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –æ—Ü–µ–Ω–æ–∫**:
- **–î–∏–∞–ø–∞–∑–æ–Ω**: [0.0, 2.0]
- **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è**: —á–µ–º –≤—ã—à–µ –æ—Ü–µ–Ω–∫–∞, —Ç–µ–º –ª—É—á—à–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —É–±—ã–≤–∞–Ω–∏—é –æ—Ü–µ–Ω–∫–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ù–∏–∑–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –í—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------|----------------|------------------|--------------|
| `lambda_mult` | –ë–æ–ª—å—à–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è | –ë–æ–ª—å—à–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ | 0.5 –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ |
| `fetch_k` | –ë—ã—Å—Ç—Ä–µ–µ —Ä–∞–±–æ—Ç–∞ | –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ | 2-5x –æ—Ç limit |
| `limit` | –ë—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞ | –ë–æ–ª—å—à–µ –≤—ã–±–æ—Ä–∞ | 10-15 –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ |
